/*! wiki-client - v0.4.6 - 2015-02-19 */
!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);throw new Error("Cannot find module '"+g+"'")}var j=c[g]={exports:{}};b[g][0].call(j.exports,function(a){var c=b[g][1][a];return e(c?c:a)},j,j.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a){console.log("Window Name: "+window.name),window.name=window.location.host,window.wiki=a("./lib/wiki"),a("./lib/legacy"),a("./lib/bind"),a("./lib/plugins")},{"./lib/bind":5,"./lib/legacy":13,"./lib/plugins":24,"./lib/wiki":36}],2:[function(a,b){var c,d,e;e={create:"☼",add:"+",edit:"✎",fork:"⚑",move:"↕",remove:"✕"},d=e.fork,c=e.add,b.exports={symbols:e,fork:d,add:c}},{}],3:[function(a,b){var c,d,e;b.exports=c={},c.scrollContainer=void 0,d=function(){var a;return a=$("body, html").filter(function(){return $(this).scrollLeft()>0}),a.length>0?a:$("body, html").scrollLeft(12).filter(function(){return $(this).scrollLeft()>0}).scrollTop(0)},e=function(a){var b,e,f,g,h,i;if(null!=a.position())return null==c.scrollContainer&&(c.scrollContainer=d()),b=$("body").width(),g=c.scrollContainer.scrollLeft(),f=g+b,h=a.position().left,i=a.outerWidth(!0),e=$(".page").outerWidth(!0)*$(".page").size(),g>h?c.scrollContainer.animate({scrollLeft:h}):h+i>f?c.scrollContainer.animate({scrollLeft:h-(b-i)}):f>$(".pages").outerWidth()?c.scrollContainer.animate({scrollLeft:Math.min(h,e-b)}):void 0},c.set=function(a){return a=$(a),$(".active").removeClass("active"),e(a.addClass("active"))}},{}],4:[function(a,b){var c,d;d=a("./util"),c=a("./actionSymbols"),b.exports=function(a,b){var e,f,g,h;return f=a.parents(".page:first"),h=b.type||"separator",null!=b.date&&(h+=" "+d.formatElapsedTime(b.date)),e=$('<a href="#" /> ').addClass("action").addClass(b.type||"separator").text(b.symbol||c.symbols[b.type]).attr("title",h).attr("data-id",b.id||"0").data("action",b),g=a.children(".control-buttons"),g.length>0?e.insertBefore(g):e.appendTo(a),"fork"===b.type&&null!=b.site?e.css("background-image","url(//"+b.site+"/favicon.png)").attr("href","//"+b.site+"/"+f.attr("id")+".html").attr("target",""+b.site).data("site",b.site).data("slug",f.attr("id")):void 0}},{"./actionSymbols":2,"./util":35}],5:[function(a){var b,c,d,e,f;c=a("./neighborhood"),d=a("./neighbors"),e=a("./searchbox"),f=a("./state"),b=a("./link"),$(function(){return e.inject(c),e.bind(),d.inject(c),d.bind(),window.seedNeighbors&&seedNeighbors.split(",").forEach(function(a){return c.registerNeighbor(a.trim())}),f.inject(b)})},{"./link":16,"./neighborhood":17,"./neighbors":18,"./searchbox":31,"./state":32}],6:[function(a,b){var c,d,e,f;f=a("./resolve"),c=null,d=function(){return c=$("<div></div>").html("This dialog will show every time!").dialog({autoOpen:!1,title:"Basic Dialog",height:600,width:800})},e=function(a,b){return c.html(b),c.dialog("option","title",f.resolveLinks(a)),c.dialog("open")},b.exports={emit:d,open:e}},{"./resolve":28}],7:[function(a,b){var c,d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};d=function(a){var b;return null!=(b=a.originalEvent.dataTransfer)&&h.call(b.types,"Files")>=0?b.files[0]:null},f=function(a){var b,c;return null!=(b=a.originalEvent.dataTransfer)&&null!=b.types&&(h.call(b.types,"text/uri-list")>=0||h.call(b.types,"text/x-moz-url")>=0)&&(c=b.getData("URL"),null!=c?c.length:void 0)?c:null},e=function(a){var b,c,d,e,f;return(b=a.match(/^http:\/\/([a-zA-Z0-9:.-]+)(\/([a-zA-Z0-9:.-]+)\/([a-z0-9-]+(_rev\d+)?))+$/))?(d={},c=b[0],e=b[1],c=b[2],d.site=b[3],d.slug=b[4],c=b[5],("view"===(f=d.site)||"local"===f||"origin"===f)&&(d.site=e),d):null},g=function(a){var b;return(b=a.match(/^https?:\/\/www.youtube.com\/watch\?v=([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/^https?:\/\/youtu.be\/([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/www.youtube.com%2Fwatch%3Fv%3D([\w\-]+).*$/))?{text:"YOUTUBE "+b[1]}:(b=a.match(/^https?:\/\/vimeo.com\/([0-9]+).*$/))?{text:"VIMEO "+b[1]}:(b=a.match(/url=https?%3A%2F%2Fvimeo.com%2F([0-9]+).*$/))?{text:"VIMEO "+b[1]}:(b=a.match(/https?:\/\/archive.org\/details\/([\w\.\-]+).*$/))?{text:"ARCHIVE "+b[1]}:(b=a.match(/https?:\/\/tedxtalks.ted.com\/video\/([\w\-]+).*$/))?{text:"TEDX "+b[1]}:(b=a.match(/https?:\/\/www.ted.com\/talks\/([\w\.\-]+).*$/))?{text:"TED "+b[1]}:null},c=function(a){return function(b){var c,h,i,j,k,l,m,n;if(k=function(){return b.preventDefault(),b.stopPropagation()},l=f(b)){if((i=e(l))&&null!=(h=a.page))return k(h(i));if((m=g(l))&&null!=(h=a.video))return k(h(m));j={url:l}}if(c=d(b)){if(null!=(h=a.file))return k(h(c));j={file:c}}return null!=(h=a.punt)?(j||(j={dt:b.dataTransfer,types:null!=(n=b.dataTransfer)?n.types:void 0}),k(h(j))):void 0}},b.exports={dispatch:c}},{}],8:[function(a,b){var c,d,e,f,g,h,i,j,k,l;h=a("./plugin"),e=a("./itemz"),g=a("./pageHandler"),f=a("./link"),i=a("./random"),c=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},l=function(a,b,i){var m,n,o,p,q,r;return null==i&&(i={}),console.log("textEditor",b.id,i),o=function(c){var g,h,j,n,o,p,q,r,s;if((c.altKey||c.ctlKey||c.metaKey)&&83===c.which)return m.focusout(),!1;if((c.altKey||c.ctlKey||c.metaKey)&&73===c.which)return c.preventDefault(),c.shiftKey||(n=$(c.target).parents(".page")),f.doInternalLink("about "+b.type+" plugin",n),!1;if("paragraph"===b.type){if(q=d(m),c.which===$.ui.keyCode.BACKSPACE&&0===q.start&&q.start===q.end)return h=a.prev(),p=e.getItem(h),"paragraph"!==p.type?!1:(j=p[i.field||"text"].length,r=m.val(),m.val(""),l(h,p,{caret:j,suffix:r}),!1);if(c.which===$.ui.keyCode.ENTER)return q?(g=a.parent().parent(),s=m.val(),o=s.substring(0,q.start),r=s.substring(q.end),""===o?(m.val(r),m.focusout(),k(g,a.prev(),o,!0)):(m.val(o),m.focusout(),k(g,a,r)),!1):!1}},n=function(){var c;if(a.removeClass("textEditing"),m.unbind(),c=a.parents(".page:first"),b[i.field||"text"]=m.val())if(h["do"](a.empty(),b),i.after){if(""===b[i.field||"text"])return;g.put(c,{type:"add",id:b.id,item:b,after:i.after})}else{if(b[i.field||"text"]===p)return;g.put(c,{type:"edit",id:b.id,item:b})}else i.after||g.put(c,{type:"remove",id:b.id}),a.remove();return null},a.hasClass("textEditing")?void 0:(a.addClass("textEditing"),a.unbind(),p=null!=(q=b[i.field||"text"])?q:"",m=$("<textarea>"+c(p)+c(null!=(r=i.suffix)?r:"")+"</textarea>").focusout(n).bind("keydown",o),a.html(m),i.caret?j(m,i.caret):i.append?(j(m,m.val().length),m.scrollTop(m[0].scrollHeight-m.height())):m.focus())},k=function(a,b,c){var d,f,g;return g={type:"paragraph",id:i.itemId(),text:c},d=$('<div class="item paragraph" data-id='+g.id+"></div>"),d.data("item",g).data("pageElement",a),b.after(d),h["do"](d,g),f=e.getItem(b),l(d,g,{after:null!=f?f.id:void 0})},d=function(a){var b,c,d;return b=a.get(0),document.selection?(b.focus(),d=document.selection.createRange(),d.moveStart("character",-b.value.length),c=d.text.length,{start:c,end:c}):{start:b.selectionStart,end:b.selectionEnd}},j=function(a,b){var c,d;return c=a.get(0),null!=c?(c.createTextRange?(d=c.createTextRange(),d.move("character",b),d.select()):c.setSelectionRange(b,b),c.focus()):void 0},b.exports={textEditor:l}},{"./itemz":12,"./link":16,"./pageHandler":20,"./plugin":23,"./random":25}],9:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;j=a("./neighborhood"),l=a("./plugin"),m=a("./resolve"),k=a("./pageHandler"),g=a("./editor"),n=a("./synopsis"),f=a("./drop"),i=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>")},h=function(a,b){var c,d;return a.append("<p>Double-Click to Edit<br>Drop Text or Image to Insert</p>"),c=function(){var c,d,e,f,h,i;for(e=a.find("p").append('<br>Or Choose a Plugin\n<center>\n<table style="text-align:left;">\n<tr><td><ul id=format><td><ul id=data><td><ul id=other>'),i=window.catalog,f=0,h=i.length;h>f;f++)d=i[f],c=d.category||"other","format"!==c&&"data"!==c&&(c="other"),e.find("#"+c).append('<li><a class="menu" href="#" title="'+d.title+'">'+d.name+"</a></li>");return e.find("a.menu").click(function(c){return a.removeClass("factory").addClass(b.type=c.target.text.toLowerCase()),a.unbind(),g.textEditor(a,b)})},d=function(){return a.append("<p>"+m.resolveLinks(b.prompt,i)+"</b>")},b.prompt?d():null!=window.catalog?c():$.getJSON("/system/factories.json",function(a){return window.catalog=a,c()})},d=function(a,b){var d,h,i,m,o;return o=function(){var c,d;a.empty().unbind(),a.removeClass("factory").addClass(b.type),c=a.parents(".page:first");try{a.data("pageElement",c),a.data("item",b),l.getPlugin(b.type,function(c){return c.emit(a,b),c.bind(a,b)})}catch(e){d=e,a.append("<p class='error'>"+d+"</p>")}return k.put(c,{type:"edit",id:b.id,item:b})},i=function(a){return b.prompt="Unexpected Item\nWe can't make sense of the drop.\nTry something else or see [[About Factory Plugin]].",a.userAgent=navigator.userAgent,b.punt=a,o()},d=function(a){return $.getJSON("http://"+a.site+"/"+a.slug+".json",function(c){return b.type="reference",b.site=a.site,b.slug=a.slug,b.title=c.title||a.slug,b.text=n(c),o(),null!=b.site?j.registerNeighbor(b.site):void 0})},h=function(a){return b.type="video",b.text=""+a.text+"\n(double-click to edit caption)\n",o()},m=function(a){var d,f,g,h;return null!=a?(h=a.type.split("/"),d=h[0],f=h[1],g=new FileReader,"image"===d?(g.onload=function(a){return b.type="image",b.url=a.target.result,b.caption||(b.caption="Uploaded image"),o()},g.readAsDataURL(a)):"text"===d?(g.onload=function(d){var g,h;return h=d.target.result,"csv"===f?(b.type="data",b.columns=(g=e(h))[0],b.data=c(g),b.text=a.fileName):(b.type="paragraph",b.text=h),o()},g.readAsText(a)):i({file:a})):void 0},a.dblclick(function(c){return c.shiftKey?g.textEditor(a,b,{field:"prompt"}):(a.removeClass("factory").addClass(b.type="paragraph"),a.unbind(),g.textEditor(a,b))}),a.bind("dragenter",function(a){return a.preventDefault()}),a.bind("dragover",function(a){return a.preventDefault()}),a.bind("drop",f.dispatch({page:d,file:m,video:h,punt:i}))},e=function(a,b){var c,d,e,f,g;for(b=b||",",e=new RegExp("(\\"+b+'|\\r?\\n|\\r|^)(?:"([^"]*(?:""[^"]*)*)"|([^"\\'+b+"\\r\\n]*))","gi"),c=[[]],d=null;d=e.exec(a);)f=d[1],f.length&&f!==b&&c.push([]),g=d[2]?d[2].replace(new RegExp('""',"g"),'"'):d[3],c[c.length-1].push(g);return c},c=function(a){var b,c,d,e,f,g;for(b=a.shift(),d=function(a){var c,d,e,f,g,h,i;for(d={},h=_.zip(b,a),f=0,g=h.length;g>f;f++)i=h[f],c=i[0],e=i[1],null!=e&&e.match(/\S/)&&"NULL"!==e&&(d[c]=e);return d},g=[],e=0,f=a.length;f>e;e++)c=a[e],g.push(d(c));return g},b.exports={emit:h,bind:d}},{"./drop":7,"./editor":8,"./neighborhood":17,"./pageHandler":20,"./plugin":23,"./resolve":28,"./synopsis":33}],10:[function(a,b){var c,d,e,f;f=a("./resolve"),e=a("./neighborhood"),d=function(a,b){var c,d,g,h,i;if(a.append(""+b.text+'<br><br><button class="create">create</button> new blank page'),null!=(c=e.sites[location.host])&&null!=c.sitemap){for(h=c.sitemap,i=[],d=0,g=h.length;g>d;d++)b=h[d],i.push(b.slug.match(/-template$/)?a.append('<br><button class="create" data-slug='+b.slug+">create</button> from "+f.resolveLinks("[["+b.title+"]]")):void 0);return i}},c=function(){},b.exports={emit:d,bind:c}},{"./neighborhood":17,"./resolve":28}],11:[function(a,b){var c,d,e,f,g;d=a("./dialog"),e=a("./editor"),g=a("./resolve"),f=function(a,b){return b.text||(b.text=b.caption),a.append('<img class=thumbnail src="'+b.url+'"> <p>'+g.resolveLinks(b.text)+"</p>")},c=function(a,b){return a.dblclick(function(){return e.textEditor(a,b)}),a.find("img").dblclick(function(){return d.open(b.text,this)})},b.exports={emit:f,bind:c}},{"./dialog":6,"./editor":8,"./resolve":28}],12:[function(a,b){var c,d,e,f,g,h,i,j;e=a("./pageHandler"),f=a("./plugin"),g=a("./random"),j=function(a,b){return setTimeout(b,a)},d=function(a){return $(a).length>0?$(a).data("item")||$(a).data("staticItem"):void 0},h=function(a,b){return e.put(a.parents(".page:first"),{type:"remove",id:b.id}),a.remove()},c=function(a,b,c){var h,i;return null==a&&(a=b.parents(".page")),c.id=g.itemId(),h=$('<div class="item '+c.type+'" data-id=""</div>'),h.data("item",c).data("pageElement",a),null!=b?b.after(h):a.find(".story").append(h),f["do"](h,c),i=d(b),j(500,function(){return e.put(a,{item:c,id:c.id,type:"add",after:null!=i?i.id:void 0})}),h},i=function(a,b,c){var d,g,h;h=$.extend({},c),a.empty().unbind(),a.removeClass(b).addClass(h.type),d=a.parents(".page:first");try{a.data("pageElement",d),a.data("item",h),f.getPlugin(c.type,function(b){return b.emit(a,h),b.bind(a,h)})}catch(i){g=i,a.append("<p class='error'>"+g+"</p>")}return e.put(d,{type:"edit",id:h.id,item:h})},b.exports={createItem:c,removeItem:h,getItem:d,replaceItem:i}},{"./pageHandler":20,"./plugin":23,"./random":25}],13:[function(a){var b,c,d,e,f,g,h,i,j,k;h=a("./pageHandler"),j=a("./state"),b=a("./active"),i=a("./refresh"),f=a("./lineup"),e=a("./drop"),d=a("./dialog"),g=a("./link"),k=a("./target"),c=a("./page").asSlug,$(function(){var c,l,m,n,o;return d.emit(),c=37,l=39,$(document).keydown(function(a){var d,e,f;return d=function(){switch(a.which){case c:return-1;case l:return 1}}(),d&&"TEXTAREA"!==a.target.tagName&&(f=$(".page"),e=f.index($(".active"))+d,e>=0&&e<f.length)?b.set(f.eq(e)):void 0}),$(window).on("popstate",j.show),$(document).ajaxError(function(a,b,c){return 0!==b.status&&404!==b.status?console.log("ajax error",a,b,c):void 0}),n=function(a,b){return a?(console.log("getTemplate",a),h.get({whenGotten:function(a){return b(a)},whenNotGotten:function(){return b(null)},pageInformation:{slug:a}})):b(null)},m=function(a,b){var c;return a.preventDefault(),a.shiftKey||(c=$(a.target).parents(".page")),g.doInternalLink(b,c,$(a.target).data("site")),!1},$(".main").delegate(".show-page-source","click",function(a){var b,c;return a.preventDefault(),b=$(this).parent().parent(),c=f.atKey(b.data("key")).getRawPage(),d.open("JSON for "+c.title,$("<pre/>").text(JSON.stringify(c,null,2)))}).delegate(".page","click",function(a){return $(a.target).is("a")?void 0:b.set(this)}).delegate(".internal","click",function(a){var b;return b=$(a.target).data("pageName"),b=""+b,h.context=$(a.target).attr("title").split(" => "),m(a,b)}).delegate("img.remote","click",function(a){var b;return b=$(a.target).data("slug"),h.context=[$(a.target).data("site")],m(a,b)}).delegate(".revision","dblclick",function(a){var b,c,e,g,h;return a.preventDefault(),b=$(this).parents(".page"),g=f.atKey(b.data("key")).getRawPage(),h=g.journal.length-1,c=g.journal[h],e=JSON.stringify(c,null,2),d.open("Revision "+h+", "+c.type+" action",$("<pre/>").text(e))}).delegate(".action","click",function(a){var c,d,e,j,k,l;return a.preventDefault(),c=$(a.target),c.is(".fork")&&null!=(j=c.data("slug"))?(h.context=[c.data("site")],m(a,j.split("_")[0])):(d=$(this).parents(".page"),e=d.data("key"),l=f.atKey(e).getSlug(),k=$(this).parent().children().not(".separator").index(c),0>k?void 0:(a.shiftKey||d.nextAll().remove(),a.shiftKey||f.removeAllAfterKey(e),g.createPage(""+l+"_rev"+k,d.data("site")).appendTo($(".main")).each(i.cycle),b.set($(".page").last())))}).delegate(".fork-page","click",function(a){var b,c,d;if(b=$(a.target).parents(".page"),d=f.atKey(b.data("key")),c={type:"fork"},b.hasClass("local")){if(h.useLocalStorage())return;b.removeClass("local")}else d.isRemote()&&(c.site=d.getRemoteSite());return null!=b.data("rev")&&(b.removeClass("ghost"),b.find(".revision").remove()),h.put(b,c)}).delegate("button.create","click",function(a){return n($(a.target).data("slug"),function(b){var c,d,e;return c=$(a.target).parents(".page:first"),c.removeClass("ghost"),e=f.atKey(c.data("key")),e.become(b),d=e.getRawPage(),i.rebuildPage(e,c.empty()),h.put(c,{type:"create",id:d.id,item:{title:d.title,story:d.story}})})}).delegate(".score","hover",function(a){return $(".main").trigger("thumb",$(a.target).data("thumb"))}).bind("dragenter",function(a){return a.preventDefault()}).bind("dragover",function(a){return a.preventDefault()}).bind("drop",e.dispatch({page:function(a){return g.doInternalLink(a.slug,null,a.site)}})),$(".provider input").click(function(){return $("footer input:first").val($(this).attr("data-provider")),$("footer form").submit()}),$("body").on("new-neighbor-done",function(){return $(".page").each(function(a,b){return i.emitTwins($(b))})}),o=a("./lineupActivity"),$("<span class=menu> &nbsp; &equiv; &nbsp; </span>").css({cursor:"pointer","font-size":"120%"}).appendTo("footer").click(function(){return d.open("Lineup Activity",o.show())}),k.bind(),$(function(){return j.first(),$(".page").each(i.cycle),b.set($(".page").last())})})},{"./active":3,"./dialog":6,"./drop":7,"./lineup":14,"./lineupActivity":15,"./link":16,"./page":19,"./pageHandler":20,"./refresh":27,"./state":32,"./target":34}],14:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};m=a("./random"),l={},j=[],c=function(a){var b;return b=m.randomBytes(4),l[b]=a,j.push(b),b},o=function(a){return q.call(j,a)<0?null:(j=j.filter(function(b){return a!==b}),delete l[a],a)},n=function(a){var b,c;if(b=[],q.call(j,a)<0)return b;for(;j[j.length-1]!==a;)c=j.pop(),b.unshift(c),delete l[c];return b},d=function(a){return l[a]},p=function(a){return d(a).getTitle()},e=function(){return j.length?p(j[j.length-1]):"Wiki"},g=function(){return j},h=function(){return l={},j=[]},i=function(a){var b,c,d;if((b=""+j)!=(d=""+a)&&(console.log("The lineup is out of sync with the dom."),console.log(".pages:",a),console.log("lineup:",j),""+Object.keys(j).sort()==""+Object.keys(a).sort()))return console.log("It looks like an ordering problem we can fix."),c=a},k=function(a){var b;return b=j.indexOf(a),1>b?null:j[b-1]},f=function(a,b){var c,d,e,f,g,h;return f=l[a],d=f.getRemoteSite(b),g=["view",h=f.getSlug()],"welcome-visitors"!==h&&g.unshift("view","welcome-visitors"),d!==b&&null!=(e=k(a))&&((c=l[e]).isRemote()||g.push(b,c.getSlug())),g.unshift(d),g},b.exports={addPage:c,removeKey:o,removeAllAfterKey:n,atKey:d,titleAtKey:p,bestTitle:e,debugKeys:g,debugReset:h,crumbs:f,debugSelfCheck:i}},{"./random":25}],15:[function(a,b){var c,d,e,f,g,h,i,j,k,l;f=a("./lineup"),d=24*(e=60*(g=60*(i=1e3))),c=function(a,b,c){var d,e,f;for(e=0,f=a.length;f>e;e++)if(d=a[e],null!=d.date&&b<d.date&&d.date<=c)return!0;return!1},k=function(a){var b,e,f,g;for(f="",b=60,e=(new Date).getTime()-b*d,g=1;b>=1?b>=g:g>=b;b>=1?g++:g--)f+=c(a,e,e+d)?"|":".",5===new Date(e).getDay()&&(f+="<td>"),e+=d;return f},h=function(a){var b,c;return b=a.getRemoteSite(location.host),c=a.getTitle(),"<tr><td align=right>\n  "+k(a.getRawPage().journal)+'\n<td>\n  <img class="remote" src="//'+b+'/favicon.png">\n  '+c},l=function(a){var b;return"<table>\n"+function(){var c,d,e;for(e=[],c=0,d=a.length;d>c;c++)b=a[c],e.push(h(f.atKey(b)));return e}().join("\n")+'\n</table>\n<p style="color: #bbb">dots are days, advancing to the right, with marks showing activity</p>'},j=function(){return l(f.debugKeys())},b.exports={show:j}},{"./lineup":14}],16:[function(a,b){var c,d,e,f,g,h,i,j,k,l;g=a("./lineup"),c=a("./active"),i=a("./refresh"),l=a("./page"),d=l.asSlug,h=l.pageEmitter,e=function(a,b){var c,d;return b&&"view"!==b&&(d=b),c=$('<div class="page" id="'+a+'">\n  <div class="twins"> <p> </p> </div>\n  <div class="header">\n    <h1> <img class="favicon" src="'+(d?"//"+d:"")+'/favicon.png" height="32px"> '+a+" </h1>\n  </div>\n</div>"),d&&c.data("site",d),c},j=function(a,b){return e(a,b).appendTo(".main").each(i.cycle)},f=function(a,b,e){return null==e&&(e=null),a=d(a),null!=b&&$(b).nextAll().remove(),null!=b&&g.removeAllAfterKey($(b).data("key")),j(a,e),c.set($(".page").last())},k=function(a){var b;return b=e(a.getSlug()).addClass("ghost"),b.appendTo($(".main")),i.buildPage(a,b),c.set($(".page").last())},h.on("show",function(a){return console.log("pageEmitter handling",a),k(a)}),b.exports={createPage:e,doInternalLink:f,showPage:j,showResult:k}},{"./active":3,"./lineup":14,"./page":19,"./refresh":27}],17:[function(a,b){var c,d,e,f,g,h={}.hasOwnProperty;g=a("underscore"),b.exports=c={},c.sites={},d=0,e=2e3,f=function(a,b){var c,f,g;if(!b.sitemapRequestInflight)return b.sitemapRequestInflight=!0,g=function(a,b,c){return $('.neighbor[data-site="'+a+'"]').find("div").removeClass(b).addClass(c)},c=function(){var c,d;return d="http://"+a+"/system/sitemap.json",g(a,"wait","fetch"),c=$.ajax({type:"GET",dataType:"json",url:d}),c.always(function(){return b.sitemapRequestInflight=!1}).done(function(c){return b.sitemap=c,g(a,"fetch","done"),$("body").trigger("new-neighbor-done",a)}).fail(function(){return g(a,"fetch","fail")})},f=Date.now(),f>d?(d=f+e,setTimeout(c,100)):(setTimeout(c,d-f),d+=e)},c.registerNeighbor=function(a){var b;if(null==c.sites[a])return b={},c.sites[a]=b,f(a,b),$("body").trigger("new-neighbor",a)},c.listNeighbors=function(){return g.keys(c.sites)},c.search=function(a){var b,d,e,f,i,j,k,l,m,n;b=[],l={},m=function(a){return null!=l[a]?l[a]++:l[a]=1},d=function(b,c){var d;return d=null!=c&&c.toLowerCase().indexOf(a.toLowerCase())>=0,d&&m(b),d},k=Date.now(),n=c.sites;for(i in n)h.call(n,i)&&(f=n[i],j=f.sitemap,null!=j&&m("sites"),e=g.each(j,function(a){return m("pages"),d("title",a.title)||d("text",a.synopsis)||d("slug",a.slug)?(m("finds"),b.push({page:a,site:i,rank:1})):void 0}));return l.msec=Date.now()-k,{finds:b,tally:l}}},{underscore:38}],18:[function(a,b){var c,d,e,f,g,h;f=a("./link"),g=null,h=0,d=function(a){return'<span class="neighbor" data-site="'+a+'">\n  <div class="wait">\n    <img src="http://'+a+'/favicon.png" title="'+a+'">\n  </div>\n</span>'},e=function(a){return g=a.sites},c=function(){var a;return a=$(".neighborhood"),$("body").on("new-neighbor",function(b,c){return a.append(d(c))}).on("new-neighbor-done",function(a,b){var c,d;return d=g[b].sitemap.length,c=$('.neighborhood .neighbor[data-site="'+b+'"]').find("img"),c.attr("title",""+b+"\n "+d+" pages"),h+=d,$(".searchbox .pages").text(""+h+" pages")}).delegate(".neighbor img","click",function(){return f.doInternalLink("welcome-visitors",null,this.title.split("\n")[0])})},b.exports={inject:e,bind:c}},{"./link":16}],19:[function(a,b){var c,d,e,f,g,h,i,j,k;e=a("./util").formatDate,i=a("./random"),j=a("./revision"),k=a("underscore"),c=a("events").EventEmitter,h=new c,d=function(a){return a.replace(/\s/g,"-").replace(/[^A-Za-z0-9-]/g,"").toLowerCase()},g=function(a){return[{symbol:"❄",date:a-316224e5,period:"a Year"},{symbol:"⚘",date:a-80352e5,period:"a Season"},{symbol:"⚪",date:a-26784e5,period:"a Month"},{symbol:"☽",date:a-6048e5,period:"a Week"},{symbol:"☀",date:a-864e5,period:"a Day"},{symbol:"⌚",date:a-36e5,period:"an Hour"}]},f=function(a,b){var c,h,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G;return C=a||{},C.title||(C.title="empty"),C.story||(C.story=[]),C.journal||(C.journal=[]),q=function(){return C},n=function(){var a,c,d,e,f,g;for(d=["view"],z()&&d.push(b),c=function(a){return null==a||k.include(d,a)?void 0:d.push(a)},g=C.journal.slice(0).reverse(),e=0,f=g.length;f>e;e++)a=g[e],c(a.site);return d},y=function(){return null!=C.plugin},z=function(){return!(void 0===b||null===b||"view"===b||"origin"===b||"local"===b)},x=function(){return"local"===b},r=function(a){return null==a&&(a=null),z()?b:a},s=function(a){var b;return null==a&&(a=null),b=[],(a||z())&&b.push(r(a)),y()&&b.push(""+C.plugin+" plugin"),b.join("\n")},u=function(){return d(C.title)},p=function(a){var c,d,e,f,g,h,i,j,l;for(e=[],z()?e.push(b):null!=a&&e.push(a),j=C.story,f=0,h=j.length;h>f;f++)d=j[f],null!=d.site&&e.push(d.site);for(l=C.journal,g=0,i=l.length;i>g;g++)c=l[g],null!=c.site&&e.push(c.site);return k.uniq(e)},w=function(){return C.title},F=function(a){return C.title=a},t=function(){return C.journal.length-1},v=function(){var a;return a=C.journal[t()].date,null!=a?e(a):"Revision "+t()},c=function(a){return a=k.extend({},{id:i.itemId()},a),C.story.push(a)},o=function(a){var b,c,d,e;for(e=C.story,c=0,d=e.length;d>c;c++)if(b=e[c],b.id===a)return b;return null},E=function(a){var b;return(b=function(c){return c>=C.story.length?void 0:a(C.story[c],function(){return b(c+1)})})(0)},h=function(a){var b;return b="paragraph",c({type:b,text:a})},D=function(a){var b,c,d;return d=0,c=g((new Date).getTime()),(b=function(e){var f,g,h,i,j,k;if(!(e>=C.journal.length)){for(f=C.journal[e],g=f.date||0,i=null,j=0,k=c.length;k>j;j++)h=c[j],h.date>d&&h.date<g&&(i=h);return d=g,a({action:f,separator:i},function(){return b(e+1)})}})(0)},m=function(a){return C.story=(null!=a?a.getRawPage().story:void 0)||[]},G=function(){var a,c;return c=u(),a="welcome-visitors"===c?"view/welcome-visitors":"view/welcome-visitors/view/"+c,z()?"//"+b+"/"+a:"/"+a},B=function(a,b){var c,d,e;for(d=0,e=a.length;e>d;d++)if(c=a[d],c.id===b.id&&c.date===b.date)return!1;return!0},A=function(a){var c,d,e,g,h;for(d=function(){var a,b,d,e;for(d=C.journal,e=[],a=0,b=d.length;b>a;a++)c=d[a],e.push(c);return e}(),h=a.getRawPage().journal,e=0,g=h.length;g>e;e++)c=h[e],B(C.journal,c)&&d.push(c);return d.push({type:"fork",site:a.getRemoteSite(),date:(new Date).getTime()}),f(j.create(999,{title:C.title,journal:d}),b)},l=function(a){return j.apply(C,a),a.site?b=null:void 0},{getRawPage:q,getContext:n,isPlugin:y,isRemote:z,isLocal:x,getRemoteSite:r,getRemoteSiteDetails:s,getSlug:u,getNeighbors:p,getTitle:w,setTitle:F,getRevision:t,getTimestamp:v,addItem:c,getItem:o,addParagraph:h,seqItems:E,seqActions:D,become:m,siteLineup:G,merge:A,apply:l}},b.exports={newPage:f,asSlug:d,pageEmitter:h}},{"./random":25,"./revision":29,"./util":35,events:37,underscore:38}],20:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n,o;o=a("underscore"),n=a("./state"),m=a("./revision"),c=a("./addToJournal"),f=a("./page").newPage,k=a("./random"),e=a("./lineup"),b.exports=h={},d=function(a){return JSON.parse(JSON.stringify(a))},h.useLocalStorage=function(){return $(".login").length>0},g=function(a){var b;return(b=localStorage.getItem(a))?JSON.parse(b):void 0},l=function(a){var b,c,d,e,h,i,j,n,o;if(d=a.pageInformation,n=a.whenGotten,o=a.whenNotGotten,b=a.localContext,i=d.slug,e=d.rev,h=d.site,h?b=[]:h=b.shift(),h===window.location.host&&(h="origin"),"view"===h&&(h=null),null!=h){if("local"===h)return(c=g(d.slug))?n(f(c,"local")):o();j="origin"===h?"/"+i+".json":"http://"+h+"/"+i+".json"}else j="/"+i+".json";return $.ajax({type:"GET",dataType:"json",url:j+("?random="+k.randomBytes(4)),success:function(a){return e&&(a=m.create(e,a)),n(f(a,h))},error:function(a,c,e){var g;return 404!==a.status&&0!==a.status?(console.log("pageHandler.get error",a,a.status,c,e),g=f({title:"Trouble: Can't Get Page"},null),g.addParagraph("The page handler has run into problems with this   request.\n<pre class=error>"+JSON.stringify(d)+"</pre>\nThe requested url.\n<pre class=error>"+j+"</pre>\nThe server reported status.\n<pre class=error>"+a.status+"</pre>\nThe error type.\n<pre class=error>"+c+"</pre>\nThe error message.\n<pre class=error>"+e+"</pre>\nThese problems are rarely solved by reporting issues.\nThere could be additional information reported in the browser's console.log.\nMore information might be accessible by fetching the page outside of wiki.\n<a href=\""+j+'" target="_blank">try-now</a>'),n(g)):b.length>0?l({pageInformation:d,whenGotten:n,whenNotGotten:o,localContext:b}):o()}})},h.get=function(a){var b,c,d,e;return d=a.whenGotten,e=a.whenNotGotten,c=a.pageInformation,!c.site&&(b=g(c.slug))?(c.rev&&(b=m.create(c.rev,b)),d(f(b,"local"))):(h.context.length||(h.context=["view"]),l({pageInformation:c,whenGotten:d,whenNotGotten:e,localContext:o.clone(h.context)}))},h.context=[],i=function(a,b,d){var f,h;return"create"===d.type?f={title:d.item.title,story:[],journal:[]}:(f=g(b.slug),f||(f=e.atKey(a.data("key")).getRawPage()),null==f.journal&&(f.journal=[]),null!=(h=d.fork)&&(f.journal=f.journal.concat({type:"fork",site:h,date:(new Date).getTime()}),delete d.fork)),m.apply(f,d),localStorage.setItem(b.slug,JSON.stringify(f)),c(a.find(".journal"),d),a.addClass("local")},j=function(a,b,f){var g,h;return g=d(f),h=e.atKey(a.data("key")),"fork"===f.type&&(g.item=d(h.getRawPage())),$.ajax({type:"PUT",url:"/page/"+b.slug+"/action",data:{action:JSON.stringify(g)},success:function(){return(null!=h?h.apply:void 0)&&h.apply(f),c(a.find(".journal"),f),"fork"===f.type?localStorage.removeItem(a.attr("id")):void 0},error:function(c,d,e){return f.error={type:d,msg:e,response:c.responseText},i(a,b,f)}})},h.put=function(a,b){var d,e,f;return d=function(){var b;switch(b=a.data("site")){case"origin":case"local":case"view":return null;case location.host:return null;default:return b}},f={slug:a.attr("id").split("_rev")[0],rev:a.attr("id").split("_rev")[1],site:d(),local:a.hasClass("local")},e=f.site,console.log("pageHandler.put",b,f),h.useLocalStorage()&&(null!=f.site?console.log("remote => local"):f.local||(console.log("origin => local"),b.site=e=location.host)),b.date=(new Date).getTime(),"origin"===b.site&&delete b.site,e&&(a.find("h1").prop("title",location.host),a.find("h1 img").attr("src","/favicon.png"),a.find("h1 a").attr("href","/"),a.data("site",null),a.removeClass("remote"),n.setUrl(),"fork"!==b.type&&(b.fork=e,c(a.find(".journal"),{type:"fork",site:e,date:b.date}))),h.useLocalStorage()||"local"===f.site?i(a,f,b):j(a,f,b)}},{"./addToJournal":4,"./lineup":14,"./page":19,"./random":25,"./revision":29,"./state":32,underscore:38}],21:[function(a,b){var c,d,e,f,g;d=a("./editor"),g=a("./resolve"),f=a("./itemz"),e=function(a,b){var c,d,e,f,h;for(f=b.text.split(/\n\n+/),h=[],d=0,e=f.length;e>d;d++)c=f[d],h.push(c.match(/\S/)?a.append("<p>"+g.resolveLinks(c)+"</p>"):void 0);return h},c=function(a,b){return a.dblclick(function(c){return c.shiftKey?(b.type="html",f.replaceItem(a,"paragraph",b)):d.textEditor(a,b,{append:!0})})},b.exports={emit:e,bind:c}},{"./editor":8,"./itemz":12,"./resolve":28}],22:[function(a,b){b.exports=function(a){var b;return $("#user-email").hide(),$("#persona-login-btn").hide(),$("#persona-logout-btn").hide(),b=function(a){return $("<div></div>").dialog({open:function(){return $(".ui-dialog-titlebar-close").hide()},buttons:{Ok:function(){return $(this).dialog("close"),navigator.id.logout()}},close:function(){return $(this).remove()},resizable:!1,title:"Login Failure",modal:!0}).html(a)},navigator.id.watch({loggedInUser:a,onlogin:function(a){return $.post("/persona_login",{assertion:a},function(a){var c;return a=JSON.parse(a),"okay"===a.status?window.location="#":"wrong-address"===a.status?b("<p>Sign in is currently only available for the site owner.</p>"):"failure"===a.status?(c=/domain mismatch/.test(a.reason)?"<p>It looks as if you are accessing the site using an alternative address.</p><p>Please check that you are using the correct address to access this site.</p>":"<p>Unable to log you in.</p>",b(c)):navigator.id.logout()})},onlogout:function(){return $.post("/persona_logout",function(){return window.location="#"})},onready:function(){return a?($("#persona-login-btn").hide(),$("#persona-logout-btn").show()):($("#persona-login-btn").show(),$("#persona-logout-btn").hide())}}),$("#persona-login-btn").click(function(a){return a.preventDefault(),navigator.id.request({})}),$("#persona-logout-btn").click(function(a){return a.preventDefault(),navigator.id.logout()})}},{}],23:[function(a,b){var c,d,e,f,g,h=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};b.exports=f={},d=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")},c=function(a,b){return b=$.extend(b||{},{dataType:"script",cache:!0,url:a}),$.ajax(b)},g=[],e=f.getScript=function(a,b){return null==b&&(b=function(){}),h.call(g,a)>=0?b():c(a).done(function(){return g.push(a),b()}).fail(function(){return b()})},f.get=f.getPlugin=function(a,b){return window.plugins[a]?b(window.plugins[a]):e("/plugins/"+a+"/"+a+".js",function(){return window.plugins[a]?b(window.plugins[a]):e("/plugins/"+a+".js",function(){return b(window.plugins[a])
})})},f["do"]=f.doPlugin=function(a,b,c){var e;return null==c&&(c=function(){}),e=function(e,f){return a.append('<div class="error">\n  '+d(b.text||"")+"\n  <button>help</button><br>\n</div>"),a.find("button").on("click",function(){return wiki.dialog(e.toString(),'<p> This "'+b.type+'" plugin won\'t show.</p>\n<li> Is it available on this server?\n<li> Is its markup correct?\n<li> Can it find necessary data?\n<li> Has network access been interrupted?\n<li> Has its code been tested?\n<p> Developers may open debugging tools and retry the plugin.</p>\n<button class="retry">retry</button>\n<p> Learn more\n  <a class="external" target="_blank" rel="nofollow"\n  href="http://plugins.fed.wiki.org/about-plugins.html"\n  title="http://plugins.fed.wiki.org/about-plugins.html">\n    About Plugins\n    <img src="/images/external-link-ltr-icon.png">\n  </a>\n</p>'),$(".retry").on("click",function(){return f.emit.length>2?f.emit(a,b,function(){return f.bind(a,b),c()}):(f.emit(a,b),f.bind(a,b),c())})})},a.data("pageElement",a.parents(".page")),a.data("item",b),f.get(b.type,function(d){var f;try{if(null==d)throw TypeError("Can't find plugin for '"+b.type+"'");return d.emit.length>2?d.emit(a,b,function(){return d.bind(a,b),c()}):(d.emit(a,b),d.bind(a,b),c())}catch(g){return f=g,console.log("plugin error",f),e(f,d),c()}})},f.registerPlugin=function(a,b){return window.plugins[a]=b($)}},{}],24:[function(a){window.plugins={reference:a("./reference"),factory:a("./factory"),paragraph:a("./paragraph"),image:a("./image"),future:a("./future")}},{"./factory":9,"./future":10,"./image":11,"./paragraph":21,"./reference":26}],25:[function(a,b){var c,d,e;d=function(){return(256*(1+Math.random())|0).toString(16).substring(1)},e=function(a){return function(){var b,c;for(c=[],b=1;a>=1?a>=b:b>=a;a>=1?b++:b--)c.push(d());return c}().join("")},c=function(){return e(8)},b.exports={randomByte:d,randomBytes:e,itemId:c}},{}],26:[function(a,b){var c,d,e,f,g;d=a("./editor"),g=a("./resolve"),f=a("./page"),e=function(a,b){var c,d;return d=b.slug,null!=b.title&&(d||(d=f.asSlug(b.title))),d||(d="welcome-visitors"),c=b.site,g.resolveFrom(c,function(){return a.append("<p style='margin-bottom:3px;'>\n  <img class='remote'\n    src='//"+c+"/favicon.png'\n    title='"+c+"'\n    data-site=\""+c+'"\n    data-slug="'+d+'"\n  >\n  '+g.resolveLinks("[["+(b.title||d)+"]]")+"\n</p>\n<div>\n  "+g.resolveLinks(b.text)+"\n</div>")})},c=function(a,b){return a.dblclick(function(){return d.textEditor(a,b)})},b.exports={emit:e,bind:c}},{"./editor":8,"./page":19,"./resolve":28}],27:[function(a,b){var c,d,e,f,g,h,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J,K,L;L=a("underscore"),D=a("./pageHandler"),F=a("./plugin"),K=a("./state"),A=a("./neighborhood"),d=a("./addToJournal"),c=a("./actionSymbols"),z=a("./lineup"),J=a("./resolve"),G=a("./random"),E=a("./page"),B=E.newPage,f=E.asSlug,C=E.pageEmitter,r=function(a){return $(a).length>0?$(a).data("item")||$(a).data("staticItem"):void 0},e=function(a,b,c){var d,e;return d=$.extend({},c),e=z.atKey(a.data("key")),null!=e.getItem(d.id)?(d.alias||(d.alias=d.id),d.id=G.itemId(),b.attr("data-id",d.id)):null!=d.alias&&null==e.getItem(d.alias)&&(d.id=d.alias,delete d.alias,b.attr("data-id",d.id)),d},t=function(a,b){var c,d,f,g,h,i,j,k,l,m,n,o,p,q;return f=b.item,l=r(f),h=$(this).parents(".page:first"),g=f.data("pageElement"),q=g.data("site"),d=f.parents(".page:first"),k=function(a,b){return a&&b&&a.get(0)===b.get(0)},o=!g||k(g,d),m=!o&&k(h,g),n=!o&&k(h,d),m&&(g.hasClass("ghost")||g.attr("id")===d.attr("id")||a.shiftKey)?void 0:(i=o?(p=$(this).children().map(function(a,b){return $(b).attr("data-id")}).get(),{type:"move",order:p}):m?(console.log("drag from",g.find("h1").text()),{type:"remove"}):n?(f.data("pageElement",h),c=f.prev(".item"),j=r(c),l=e(h,f,l),{type:"add",item:l,after:null!=j?j.id:void 0}):void 0,i.id=l.id,D.put(h,i))},x=function(a){var b,c;return c={connectWith:".page .story",placeholder:"item-placeholder",forcePlaceholderSize:!0},b=a.find(".story"),b.sortable(c).on("sortupdate",t)},s=function(a){var b;return b=$(a).parents(".page:first"),z.atKey(b.data("key"))},v=function(a,b){var c,d;return c=s(b.draggable),d=s(a.target),C.emit("show",d.merge(c))},y=function(a){var b;return b=a.find(".journal"),b.draggable({revert:!0,appendTo:".main",scroll:!1,helper:"clone"}),b.droppable({hoverClass:"ui-state-hover",drop:v})},w=function(a){return a.find(".add-factory").live("click",function(b){return a.hasClass("ghost")?void 0:(b.preventDefault(),h(a))})},h=function(a){var b,c,d,e;return e={type:"factory",id:G.itemId()},c=$("<div />",{"class":"item factory"}).data("item",e).attr("data-id",e.id),c.data("pageElement",a),a.find(".story").append(c),F["do"](c,e),b=c.prev(".item"),d=r(b),D.put(a,{item:e,id:e.id,type:"add",after:null!=d?d.id:void 0})},u=function(a){var b,c,d,e,f;return a.preventDefault(),z.debugSelfCheck(function(){var a,b,c,e;for(c=$(".page"),e=[],a=0,b=c.length;b>a;a++)d=c[a],e.push($(d).data("key"));return e}()),b=$(a.target).parents(".page:first"),c=z.crumbs(b.data("key"),location.host),f=c[0],e=window.open("//"+c.join("/"),f),e.focus()},o=function(a,b,c){var d,e;return d=c.getRemoteSite(location.host),e=c.getRemoteSiteDetails(location.host),a.append('<h1 title="'+e+'">\n  <a href="'+c.siteLineup()+'" target="'+d+'">\n    <img src="//'+d+'/favicon.png" height="32px" class="favicon">\n  </a> '+J.escape(c.getTitle())+"\n</h1>"),a.find("a").on("click",u)},p=function(a,b,c){return b.attr("id").match(/_rev/)?(b.addClass("ghost"),b.data("rev",c.getRevision()),a.append($('<h2 class="revision">\n  <span>\n    '+c.getTimestamp()+"\n  </span>\n</h2>"))):void 0},m=function(a){return a.append('<div class="control-buttons">\n  <a href="#" class="button fork-page" title="fork this page">'+c.fork+'</a>\n  <a href="#" class="button add-factory" title="add paragraph">'+c.add+"</a>\n</div>")},n=function(a,b){var c,d;return c=b.getRemoteSite(location.host),d=b.getSlug(),a.append('<a id="license" href="http://creativecommons.org/licenses/by-sa/3.0/">CC BY-SA 3.0</a> .\n<a class="show-page-source" href="/'+d+".json?random="+G.randomBytes(4)+'" title="source">JSON</a> .\n<a href= "//'+c+"/"+d+'.html" target="'+c+'">'+c+" </a>")},l=function(a){var b,c,d;for(d=a||[],c=d.length-1;c>=0;c+=-1)if(b=d[c],b.date&&"fork"!==b.type)return b.date;return void 0},q=function(a){var b,c,d,e,g,h,i,j,k,m,n,o,p,q,r,s,t;if(j=a.data("data"),j&&(m=a.data("site")||window.location.host,("view"===m||"origin"===m)&&(m=window.location.host),n=f(j.title),p=l(j.journal))){c={newer:[],same:[],older:[]},s=A.sites;for(k in s)if(g=s[k],k!==m&&null!=g.sitemap)for(t=g.sitemap,q=0,r=t.length;r>q;q++)h=t[q],h.slug===n&&(b=h.date>p?c.newer:h.date<p?c.older:c.same,b.push({remoteSite:k,item:h}));o=[];for(i in c)b=c[i],b.length&&(b.sort(function(a,b){return a.item.date<b.item.date}),d=function(){var a,c,d,f;for(f=[],e=a=0,c=b.length;c>a&&(d=b[e],k=d.remoteSite,h=d.item,!(e>=8));e=++a)f.push('<img class="remote"\nsrc="http://'+k+'/favicon.png"\ndata-slug="'+n+'"\ndata-site="'+k+'"\ntitle="'+k+'">');return f}(),o.push(""+d.join("&nbsp;")+" "+i));if(o)return a.find(".twins").html("<p>"+o.join(", ")+"</p>")}},I=function(a,b){var c,e,f,g,h,j,k;return b.data("data",a.getRawPage()),a.isRemote()&&b.data("site",a.getRemoteSite()),console.log(".page keys ",function(){var a,b,c,d;for(c=$(".page"),d=[],a=0,b=c.length;b>a;a++)j=c[a],d.push($(j).data("key"));return d}()),console.log("lineup keys",z.debugKeys()),J.resolutionContext=a.getContext(),b.empty(),k=["twins","header","story","journal","footer"].map(function(a){return $("<div />").addClass(a).appendTo(b)}),h=k[0],e=k[1],g=k[2],f=k[3],c=k[4],o(e,b,a),p(e,b,a),a.seqItems(function(a,b){var c;return(null!=a?a.type:void 0)&&(null!=a?a.id:void 0)?(c=$('<div class="item '+a.type+'" data-id="'+a.id+'">'),g.append(c),F["do"](c,a,b)):(g.append($('<div><p class="error">Can\'t make sense of story['+i+"]</p></div>")),b())}),a.seqActions(function(a,b){return a.separator&&d(f,a.separator),d(f,a.action),b()}),q(b),m(f),n(c,a)},j=function(a,b){return b.isRemote()?void 0:$("img.favicon",a).error(function(){return F.get("favicon",function(a){return a.create()})})},H=function(a,b){return a.isLocal()&&b.addClass("local"),a.isRemote()&&b.addClass("remote"),a.isPlugin()&&b.addClass("plugin"),I(a,b),j(b,a),K.setUrl(),x(b),y(b),w(b),b},g=function(a,b){return b.data("key",z.addPage(a)),H(a,b)},k=function(){var a,b,c,d,e,f,h;return a=$(this),h=a.attr("id").split("_rev"),e=h[0],d=h[1],c={slug:e,rev:d,site:a.data("site")},b=function(){var b,c,d,f,h,i,j,k,l,m;j=$('a[href="/'+e+'.html"]:last').text()||e,f=B(),f.setTitle(j),c=[],m=A.sites;for(i in m)d=m[i],null!=d.sitemap&&(h=L.find(d.sitemap,function(a){return a.slug===e}),null!=h&&c.push({type:"reference",site:i,slug:e,title:h.title||e,text:h.synopsis||""}));if(c.length>0)for(f.addItem({type:"future",text:"We could not find this page in the expected context.",title:j}),f.addItem({type:"paragraph",text:"We did find the page in your current neighborhood."}),k=0,l=c.length;l>k;k++)b=c[k],f.addItem(b);else f.addItem({type:"future",text:"We could not find this page.",title:j});return g(f,a).addClass("ghost")},f=function(b){var c,d,e,f,h;for(g(b,a),f=b.getNeighbors(location.host),h=[],d=0,e=f.length;e>d;d++)c=f[d],h.push(A.registerNeighbor(c));return h},D.get({whenGotten:f,whenNotGotten:b,pageInformation:c})},b.exports={cycle:k,emitTwins:q,buildPage:g,rebuildPage:H}},{"./actionSymbols":2,"./addToJournal":4,"./lineup":14,"./neighborhood":17,"./page":19,"./pageHandler":20,"./plugin":23,"./random":25,"./resolve":28,"./state":32,underscore:38}],28:[function(a,b){var c,d,e;c=a("./page").asSlug,b.exports=e={},e.resolutionContext=[],e.escape=d=function(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},e.resolveFrom=function(a,b){e.resolutionContext.push(a);try{return b()}finally{e.resolutionContext.pop()}},e.resolveLinks=function(a,b){var f,g,h,i,j;return null==b&&(b=d),i=[],h=function(a){var b;return b=i.length,i.push(a),"〖"+b+"〗"},j=function(a,b){return i[+b]},g=function(a,b){var f;return f=c(b),h('<a class="internal" href="/'+f+'.html" data-page-name="'+f+'" title="'+e.resolutionContext.join(" => ")+'">'+d(b)+"</a>")},f=function(a,b,c,e){return h('<a class="external" target="_blank" href="'+b+'" title="'+b+'" rel="nofollow">'+d(e)+' <img src="/images/external-link-ltr-icon.png"></a>')},a=a.replace(/〖(\d+)〗/g,"〖 $1 〗").replace(/\[\[([^\]]+)\]\]/gi,g).replace(/\[((http|https|ftp):.*?) (.*?)\]/gi,f),b(a).replace(/〖(\d+)〗/g,j)}},{"./page":19}],29:[function(a,b){var c,d;c=function(a,b){var c,d,e,f,g,h;switch(g=function(){var b,c,d,e,f;for(e=a.story||[],f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.id);return f},c=function(b,c){var d;return d=g().indexOf(b)+1,a.story.splice(d,0,c)},h=function(){var c;return-1!==(c=g().indexOf(b.id))?a.story.splice(c,1):void 0},a.story||(a.story=[]),b.type){case"create":null!=b.item&&(null!=b.item.title&&(a.title=b.item.title),null!=b.item.story&&(a.story=b.item.story.slice()));break;case"add":c(b.after,b.item);break;case"edit":-1!==(e=g().indexOf(b.id))?a.story.splice(e,1,b.item):a.story.push(b.item);break;case"move":e=b.order.indexOf(b.id),d=b.order[e-1],f=a.story[g().indexOf(b.id)],h(),c(d,f);break;case"remove":h()}return a.journal||(a.journal=[]),a.journal.push(b)},d=function(a,b){var d,e,f,g,h;for(a=+a,e=b.journal.slice(0,+a+1||9e9),f={title:b.title,story:[]},g=0,h=e.length;h>g;g++)d=e[g],c(f,d);return f},b.exports={create:d,apply:c}},{}],30:[function(a,b){var c,d,e,f;e=a("./link"),c=a("./active"),f=a("./page").newPage,d=function(a){var b,c;return b=a.neighborhood,c=function(a){var c,d,g,h,i,j,k;for(g=b.search(a),h=g.tally,d=f(),d.setTitle("Search for '"+a+"'"),d.addParagraph("String '"+a+"' found on "+(h.finds||"none")+" of "+(h.pages||"no")+" pages from "+(h.sites||"no")+" sites.\nText matched on "+(h.title||"no")+" titles, "+(h.text||"no")+" paragraphs, and "+(h.slug||"no")+" slugs.\nElapsed time "+h.msec+" milliseconds."),k=g.finds,i=0,j=k.length;j>i;i++)c=k[i],d.addItem({type:"reference",site:c.site,slug:c.page.slug,title:c.page.title,text:c.page.synopsis||""});return e.showResult(d)},{performSearch:c}},b.exports=d},{"./active":3,"./link":16,"./page":19}],31:[function(a,b){var c,d,e,f;d=a("./search"),f=null,e=function(a){return f=d({neighborhood:a})},c=function(){return $("input.search").on("keypress",function(a){var b;if(13===a.keyCode)return b=$(this).val(),f.performSearch(b),$(this).val("")})},b.exports={inject:e,bind:c}},{"./search":30}],32:[function(a,b){var c,d,e,f,g=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};c=a("./active"),d=a("./lineup"),e=null,b.exports=f={},f.inject=function(a){return e=a},f.pagesInDom=function(){return $.makeArray($(".page").map(function(a,b){return b.id}))},f.urlPages=function(){var a;return function(){var b,c,d,e;for(d=location.hash.slice(1).split("/"),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e}().slice(1)},f.locsInDom=function(){return $.makeArray($(".page").map(function(a,b){return $(b).data("site")||"view"}))},f.urlLocs=function(){var a,b,c,d,e;for(d=location.hash.slice(1).split("/").slice(1),e=[],b=0,c=d.length;c>b;b+=2)a=d[b],e.push(a);return e},f.setUrl=function(){var a,b,c,e,g;return document.title=d.bestTitle(),history&&history.pushState&&(b=f.locsInDom(),e=f.pagesInDom(),g="#"+function(){var d,f,g;for(g=[],a=d=0,f=e.length;f>d;a=++d)c=e[a],g.push("/"+((null!=b?b[a]:void 0)||"view")+"/"+c);return g}().join(""),g!==location.hash)?history.pushState(null,null,g):void 0},f.show=function(){var a,b,g,h,i,j,k,l,m,n,o,p,q;if(m=f.pagesInDom(),j=f.urlPages(),l=f.locsInDom(),i=f.urlLocs(),location.hash&&"/"!==location.hash){for(g=!0,b=n=0,p=m.length;p>n;b=++n)h=m[b],g&&(g=h===j[b])||(k=$(".page:last"),d.removeKey(k.data("key")),k.remove());for(g=!0,b=o=0,q=j.length;q>o;b=++o)h=j[b],g&&(g=h===m[b])||(console.log("push",b,h),e.showPage(h,i[b]));return console.log("a .page keys ",function(){var b,c,d,e;for(d=$(".page"),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push($(a).data("key"));return e}()),console.log("a lineup keys",d.debugKeys()),c.set($(".page").last()),document.title=d.bestTitle()}},f.first=function(){var a,b,c,d,h,i,j,k;for(f.setUrl(),b=f.urlPages(),a=f.urlLocs(),d=f.pagesInDom(),k=[],c=i=0,j=b.length;j>i;c=++i)h=b[c],g.call(d,h)<0&&k.push(""!==h?e.createPage(h,a[c]):void 0);return k}},{"./active":3,"./lineup":14}],33:[function(a,b){b.exports=function(a){var b,c,d;return d=a.synopsis,null!=a&&null!=a.story?(b=a.story[0],c=a.story[1],b&&"paragraph"===b.type&&(d||(d=b.text)),c&&"paragraph"===c.type&&(d||(d=c.text)),b&&null!=b.text&&(d||(d=b.text)),c&&null!=c.text&&(d||(d=c.text)),d||(d=null!=a.story&&"A page with "+a.story.length+" items.")):d="A page with no story.",d}},{}],34:[function(a,b){var c,d,e,f,g,h,i,j,k,l,m;m=!1,h=null,c=null,e=function(){return $(document).keydown(function(a){return 16===a.keyCode?k(a):void 0}).keyup(function(a){return 16===a.keyCode?l(a):void 0}),$(".main").delegate(".item","mouseenter",g).delegate(".item","mouseleave",j).delegate(".action","mouseenter",f).delegate(".action","mouseleave",i).delegate(".page","align-item",d)},k=function(a){var b;return m=a.shiftKey,m&&(b=h||c)?$("[data-id="+b+"]").addClass("target"):void 0},l=function(a){return m=a.shiftKey,m?void 0:$(".item, .action").removeClass("target")},g=function(){var a,b,c,d;return h=(a=$(this)).attr("data-id"),m?($("[data-id="+h+"]").addClass("target"),c=(b=$(this).parents(".page:first")).data("key"),d=a.offset().top,$(".page").trigger("align-item",{key:c,id:h,place:d})):void 0},j=function(){return m&&$(".item, .action").removeClass("target"),h=null},f=function(){var a;return c=$(this).data("id"),m?($("[data-id="+c+"]").addClass("target"),a=$(this).parents(".page:first").data("key"),$(".page").trigger("align-item",{key:a,id:c})):void 0},i=function(){return m&&$("[data-id="+c+"]").removeClass("target"),c=null},d=function(a,b){var c,d,e,f;return d=$(this),d.data("key")!==b.key&&(c=d.find(".item[data-id="+b.id+"]"),c.length)?(f=b.place||d.height()/2,e=c.offset().top+d.scrollTop()-f,d.stop().animate({scrollTop:e},"slow")):void 0},b.exports={bind:e}},{}],35:[function(a,b){var c;b.exports=c={},c.formatTime=function(a){var b,c,d,e,f;return c=new Date(a>1e10?a:1e3*a),f=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getHours(),b=12>d?"AM":"PM",d=0===d?12:d>12?d-12:d,e=(c.getMinutes()<10?"0":"")+c.getMinutes(),""+d+":"+e+" "+b+"<br>"+c.getDate()+" "+f+" "+c.getFullYear()},c.formatDate=function(a){var b,c,d,e,f,g,h,i,j;return c=new Date(a),i=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][c.getDay()],g=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][c.getMonth()],d=c.getDate(),j=c.getFullYear(),e=c.getHours(),b=12>e?"AM":"PM",e=0===e?12:e>12?e-12:e,f=(c.getMinutes()<10?"0":"")+c.getMinutes(),h=(c.getSeconds()<10?"0":"")+c.getSeconds(),""+i+" "+g+" "+d+", "+j+"<br>"+e+":"+f+":"+h+" "+b},c.formatElapsedTime=function(a){var b,c,d,e,f,g,h,i;return f=(new Date).getTime()-a,(g=f/1e3)<2?""+Math.floor(f)+" milliseconds ago":(d=g/60)<2?""+Math.floor(g)+" seconds ago":(c=d/60)<2?""+Math.floor(d)+" minutes ago":(b=c/24)<2?""+Math.floor(c)+" hours ago":(h=b/7)<2?""+Math.floor(b)+" days ago":(e=b/31)<2?""+Math.floor(h)+" weeks ago":(i=b/365)<2?""+Math.floor(e)+" months ago":""+Math.floor(i)+" years ago"}},{}],36:[function(a,b){var c,d,e,f,g,h,i,j,k=[].slice;j={},j.asSlug=a("./page").asSlug,e=a("./itemz"),j.removeItem=e.removeItem,j.createItem=e.createItem,j.getItem=e.getItem,c=a("./dialog"),j.dialog=c.open,f=a("./link"),j.createPage=f.createPage,j.doInternalLink=f.doInternalLink,h=a("./plugin"),j.getScript=h.getScript,j.getPlugin=h.getPlugin,j.doPlugin=h.doPlugin,j.registerPlugin=h.registerPlugin,j.getData=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{}):(c=$(".chart,.data,.calculator").last(),null!=c?c.data("item").data:{})},j.getDataNodes=function(a){var b,c;return a?(b=$(".item").index(a),c=$(".item:lt("+b+")").filter(".chart,.data,.calculator").toArray().reverse(),$(c)):(c=$(".chart,.data,.calculator").toArray().reverse(),$(c))},j.log=function(){var a;return a=1<=arguments.length?k.call(arguments,0):[],null!=("undefined"!=typeof console&&null!==console?console.log:void 0)?console.log.apply(console,a):void 0},j.neighborhood=a("./neighborhood").sites,g=a("./pageHandler"),j.pageHandler=g,j.useLocalStorage=g.useLocalStorage,i=a("./resolve"),j.resolveFrom=i.resolveFrom,j.resolveLinks=i.resolveLinks,j.resolutionContext=i.resolutionContext,d=a("./editor"),j.textEditor=d.textEditor,j.util=a("./util"),j.persona=a("./persona"),j.createSynopsis=a("./synopsis"),b.exports=j},{"./dialog":6,"./editor":8,"./itemz":12,"./link":16,"./neighborhood":17,"./page":19,"./pageHandler":20,"./persona":22,"./plugin":23,"./resolve":28,"./synopsis":33,"./util":35}],37:[function(a,b){function c(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function d(a){return"function"==typeof a}function e(a){return"number"==typeof a}function f(a){return"object"==typeof a&&null!==a}function g(a){return void 0===a}b.exports=c,c.EventEmitter=c,c.prototype._events=void 0,c.prototype._maxListeners=void 0,c.defaultMaxListeners=10,c.prototype.setMaxListeners=function(a){if(!e(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},c.prototype.emit=function(a){var b,c,e,h,i,j;if(this._events||(this._events={}),"error"===a&&(!this._events.error||f(this._events.error)&&!this._events.error.length))throw b=arguments[1],b instanceof Error?b:TypeError('Uncaught, unspecified "error" event.');if(c=this._events[a],g(c))return!1;if(d(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];c.apply(this,h)}else if(f(c)){for(e=arguments.length,h=new Array(e-1),i=1;e>i;i++)h[i-1]=arguments[i];for(j=c.slice(),e=j.length,i=0;e>i;i++)j[i].apply(this,h)}return!0},c.prototype.addListener=function(a,b){var e;if(!d(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,d(b.listener)?b.listener:b),this._events[a]?f(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,f(this._events[a])&&!this._events[a].warned){var e;e=g(this._maxListeners)?c.defaultMaxListeners:this._maxListeners,e&&e>0&&this._events[a].length>e&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace())}return this},c.prototype.on=c.prototype.addListener,c.prototype.once=function(a,b){function c(){this.removeListener(a,c),e||(e=!0,b.apply(this,arguments))}if(!d(b))throw TypeError("listener must be a function");var e=!1;return c.listener=b,this.on(a,c),this},c.prototype.removeListener=function(a,b){var c,e,g,h;if(!d(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],g=c.length,e=-1,c===b||d(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(f(c)){for(h=g;h-->0;)if(c[h]===b||c[h].listener&&c[h].listener===b){e=h;break}if(0>e)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(e,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},c.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],d(c))this.removeListener(a,c);else for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},c.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?d(this._events[a])?[this._events[a]]:this._events[a].slice():[]},c.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?d(a._events[b])?1:a._events[b].length:0}},{}],38:[function(a,b,c){(function(){var a=this,d=a._,e={},f=Array.prototype,g=Object.prototype,h=Function.prototype,i=f.push,j=f.slice,k=f.concat,l=g.toString,m=g.hasOwnProperty,n=f.forEach,o=f.map,p=f.reduce,q=f.reduceRight,r=f.filter,s=f.every,t=f.some,u=f.indexOf,v=f.lastIndexOf,w=Array.isArray,x=Object.keys,y=h.bind,z=function(a){return a instanceof z?a:this instanceof z?void(this._wrapped=a):new z(a)};"undefined"!=typeof c?("undefined"!=typeof b&&b.exports&&(c=b.exports=z),c._=z):a._=z,z.VERSION="1.6.0";var A=z.each=z.forEach=function(a,b,c){if(null==a)return a;if(n&&a.forEach===n)a.forEach(b,c);else if(a.length===+a.length){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d,a)===e)return}else for(var g=z.keys(a),d=0,f=g.length;f>d;d++)if(b.call(c,a[g[d]],g[d],a)===e)return;return a};z.map=z.collect=function(a,b,c){var d=[];return null==a?d:o&&a.map===o?a.map(b,c):(A(a,function(a,e,f){d.push(b.call(c,a,e,f))}),d)};var B="Reduce of empty array with no initial value";z.reduce=z.foldl=z.inject=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),p&&a.reduce===p)return d&&(b=z.bind(b,d)),e?a.reduce(b,c):a.reduce(b);if(A(a,function(a,f,g){e?c=b.call(d,c,a,f,g):(c=a,e=!0)}),!e)throw new TypeError(B);return c},z.reduceRight=z.foldr=function(a,b,c,d){var e=arguments.length>2;if(null==a&&(a=[]),q&&a.reduceRight===q)return d&&(b=z.bind(b,d)),e?a.reduceRight(b,c):a.reduceRight(b);var f=a.length;if(f!==+f){var g=z.keys(a);f=g.length}if(A(a,function(h,i,j){i=g?g[--f]:--f,e?c=b.call(d,c,a[i],i,j):(c=a[i],e=!0)}),!e)throw new TypeError(B);return c},z.find=z.detect=function(a,b,c){var d;return C(a,function(a,e,f){return b.call(c,a,e,f)?(d=a,!0):void 0}),d},z.filter=z.select=function(a,b,c){var d=[];return null==a?d:r&&a.filter===r?a.filter(b,c):(A(a,function(a,e,f){b.call(c,a,e,f)&&d.push(a)}),d)},z.reject=function(a,b,c){return z.filter(a,function(a,d,e){return!b.call(c,a,d,e)},c)},z.every=z.all=function(a,b,c){b||(b=z.identity);var d=!0;return null==a?d:s&&a.every===s?a.every(b,c):(A(a,function(a,f,g){return(d=d&&b.call(c,a,f,g))?void 0:e}),!!d)};var C=z.some=z.any=function(a,b,c){b||(b=z.identity);var d=!1;return null==a?d:t&&a.some===t?a.some(b,c):(A(a,function(a,f,g){return d||(d=b.call(c,a,f,g))?e:void 0}),!!d)};z.contains=z.include=function(a,b){return null==a?!1:u&&a.indexOf===u?-1!=a.indexOf(b):C(a,function(a){return a===b})},z.invoke=function(a,b){var c=j.call(arguments,2),d=z.isFunction(b);return z.map(a,function(a){return(d?b:a[b]).apply(a,c)})},z.pluck=function(a,b){return z.map(a,z.property(b))},z.where=function(a,b){return z.filter(a,z.matches(b))},z.findWhere=function(a,b){return z.find(a,z.matches(b))},z.max=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.max.apply(Math,a);var d=-1/0,e=-1/0;return A(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;h>e&&(d=a,e=h)}),d},z.min=function(a,b,c){if(!b&&z.isArray(a)&&a[0]===+a[0]&&a.length<65535)return Math.min.apply(Math,a);var d=1/0,e=1/0;return A(a,function(a,f,g){var h=b?b.call(c,a,f,g):a;e>h&&(d=a,e=h)}),d},z.shuffle=function(a){var b,c=0,d=[];return A(a,function(a){b=z.random(c++),d[c-1]=d[b],d[b]=a}),d},z.sample=function(a,b,c){return null==b||c?(a.length!==+a.length&&(a=z.values(a)),a[z.random(a.length-1)]):z.shuffle(a).slice(0,Math.max(0,b))};var D=function(a){return null==a?z.identity:z.isFunction(a)?a:z.property(a)};z.sortBy=function(a,b,c){return b=D(b),z.pluck(z.map(a,function(a,d,e){return{value:a,index:d,criteria:b.call(c,a,d,e)}}).sort(function(a,b){var c=a.criteria,d=b.criteria;if(c!==d){if(c>d||void 0===c)return 1;if(d>c||void 0===d)return-1}return a.index-b.index}),"value")};var E=function(a){return function(b,c,d){var e={};return c=D(c),A(b,function(f,g){var h=c.call(d,f,g,b);a(e,h,f)}),e}};z.groupBy=E(function(a,b,c){z.has(a,b)?a[b].push(c):a[b]=[c]}),z.indexBy=E(function(a,b,c){a[b]=c}),z.countBy=E(function(a,b){z.has(a,b)?a[b]++:a[b]=1}),z.sortedIndex=function(a,b,c,d){c=D(c);for(var e=c.call(d,b),f=0,g=a.length;g>f;){var h=f+g>>>1;c.call(d,a[h])<e?f=h+1:g=h}return f},z.toArray=function(a){return a?z.isArray(a)?j.call(a):a.length===+a.length?z.map(a,z.identity):z.values(a):[]},z.size=function(a){return null==a?0:a.length===+a.length?a.length:z.keys(a).length},z.first=z.head=z.take=function(a,b,c){return null==a?void 0:null==b||c?a[0]:0>b?[]:j.call(a,0,b)},z.initial=function(a,b,c){return j.call(a,0,a.length-(null==b||c?1:b))},z.last=function(a,b,c){return null==a?void 0:null==b||c?a[a.length-1]:j.call(a,Math.max(a.length-b,0))},z.rest=z.tail=z.drop=function(a,b,c){return j.call(a,null==b||c?1:b)},z.compact=function(a){return z.filter(a,z.identity)};var F=function(a,b,c){return b&&z.every(a,z.isArray)?k.apply(c,a):(A(a,function(a){z.isArray(a)||z.isArguments(a)?b?i.apply(c,a):F(a,b,c):c.push(a)}),c)};z.flatten=function(a,b){return F(a,b,[])},z.without=function(a){return z.difference(a,j.call(arguments,1))},z.partition=function(a,b){var c=[],d=[];return A(a,function(a){(b(a)?c:d).push(a)}),[c,d]},z.uniq=z.unique=function(a,b,c,d){z.isFunction(b)&&(d=c,c=b,b=!1);var e=c?z.map(a,c,d):a,f=[],g=[];return A(e,function(c,d){(b?d&&g[g.length-1]===c:z.contains(g,c))||(g.push(c),f.push(a[d]))}),f},z.union=function(){return z.uniq(z.flatten(arguments,!0))},z.intersection=function(a){var b=j.call(arguments,1);return z.filter(z.uniq(a),function(a){return z.every(b,function(b){return z.contains(b,a)})})},z.difference=function(a){var b=k.apply(f,j.call(arguments,1));return z.filter(a,function(a){return!z.contains(b,a)})},z.zip=function(){for(var a=z.max(z.pluck(arguments,"length").concat(0)),b=new Array(a),c=0;a>c;c++)b[c]=z.pluck(arguments,""+c);return b},z.object=function(a,b){if(null==a)return{};for(var c={},d=0,e=a.length;e>d;d++)b?c[a[d]]=b[d]:c[a[d][0]]=a[d][1];return c},z.indexOf=function(a,b,c){if(null==a)return-1;var d=0,e=a.length;if(c){if("number"!=typeof c)return d=z.sortedIndex(a,b),a[d]===b?d:-1;d=0>c?Math.max(0,e+c):c}if(u&&a.indexOf===u)return a.indexOf(b,c);for(;e>d;d++)if(a[d]===b)return d;return-1},z.lastIndexOf=function(a,b,c){if(null==a)return-1;var d=null!=c;if(v&&a.lastIndexOf===v)return d?a.lastIndexOf(b,c):a.lastIndexOf(b);for(var e=d?c:a.length;e--;)if(a[e]===b)return e;return-1},z.range=function(a,b,c){arguments.length<=1&&(b=a||0,a=0),c=arguments[2]||1;for(var d=Math.max(Math.ceil((b-a)/c),0),e=0,f=new Array(d);d>e;)f[e++]=a,a+=c;return f};var G=function(){};z.bind=function(a,b){var c,d;if(y&&a.bind===y)return y.apply(a,j.call(arguments,1));if(!z.isFunction(a))throw new TypeError;return c=j.call(arguments,2),d=function(){if(!(this instanceof d))return a.apply(b,c.concat(j.call(arguments)));G.prototype=a.prototype;var e=new G;G.prototype=null;var f=a.apply(e,c.concat(j.call(arguments)));return Object(f)===f?f:e}},z.partial=function(a){var b=j.call(arguments,1);return function(){for(var c=0,d=b.slice(),e=0,f=d.length;f>e;e++)d[e]===z&&(d[e]=arguments[c++]);for(;c<arguments.length;)d.push(arguments[c++]);return a.apply(this,d)}},z.bindAll=function(a){var b=j.call(arguments,1);if(0===b.length)throw new Error("bindAll must be passed function names");return A(b,function(b){a[b]=z.bind(a[b],a)}),a},z.memoize=function(a,b){var c={};return b||(b=z.identity),function(){var d=b.apply(this,arguments);return z.has(c,d)?c[d]:c[d]=a.apply(this,arguments)}},z.delay=function(a,b){var c=j.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)},z.defer=function(a){return z.delay.apply(z,[a,1].concat(j.call(arguments,1)))},z.throttle=function(a,b,c){var d,e,f,g=null,h=0;c||(c={});var i=function(){h=c.leading===!1?0:z.now(),g=null,f=a.apply(d,e),d=e=null};return function(){var j=z.now();h||c.leading!==!1||(h=j);var k=b-(j-h);return d=this,e=arguments,0>=k?(clearTimeout(g),g=null,h=j,f=a.apply(d,e),d=e=null):g||c.trailing===!1||(g=setTimeout(i,k)),f}},z.debounce=function(a,b,c){var d,e,f,g,h,i=function(){var j=z.now()-g;b>j?d=setTimeout(i,b-j):(d=null,c||(h=a.apply(f,e),f=e=null))};return function(){f=this,e=arguments,g=z.now();var j=c&&!d;return d||(d=setTimeout(i,b)),j&&(h=a.apply(f,e),f=e=null),h}},z.once=function(a){var b,c=!1;return function(){return c?b:(c=!0,b=a.apply(this,arguments),a=null,b)}},z.wrap=function(a,b){return z.partial(b,a)},z.compose=function(){var a=arguments;return function(){for(var b=arguments,c=a.length-1;c>=0;c--)b=[a[c].apply(this,b)];return b[0]}},z.after=function(a,b){return function(){return--a<1?b.apply(this,arguments):void 0}},z.keys=function(a){if(!z.isObject(a))return[];if(x)return x(a);var b=[];for(var c in a)z.has(a,c)&&b.push(c);return b},z.values=function(a){for(var b=z.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=a[b[e]];return d},z.pairs=function(a){for(var b=z.keys(a),c=b.length,d=new Array(c),e=0;c>e;e++)d[e]=[b[e],a[b[e]]];return d},z.invert=function(a){for(var b={},c=z.keys(a),d=0,e=c.length;e>d;d++)b[a[c[d]]]=c[d];return b},z.functions=z.methods=function(a){var b=[];for(var c in a)z.isFunction(a[c])&&b.push(c);return b.sort()},z.extend=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)a[c]=b[c]}),a},z.pick=function(a){var b={},c=k.apply(f,j.call(arguments,1));return A(c,function(c){c in a&&(b[c]=a[c])}),b},z.omit=function(a){var b={},c=k.apply(f,j.call(arguments,1));for(var d in a)z.contains(c,d)||(b[d]=a[d]);return b},z.defaults=function(a){return A(j.call(arguments,1),function(b){if(b)for(var c in b)void 0===a[c]&&(a[c]=b[c])}),a},z.clone=function(a){return z.isObject(a)?z.isArray(a)?a.slice():z.extend({},a):a},z.tap=function(a,b){return b(a),a};var H=function(a,b,c,d){if(a===b)return 0!==a||1/a==1/b;
if(null==a||null==b)return a===b;a instanceof z&&(a=a._wrapped),b instanceof z&&(b=b._wrapped);var e=l.call(a);if(e!=l.call(b))return!1;switch(e){case"[object String]":return a==String(b);case"[object Number]":return a!=+a?b!=+b:0==a?1/a==1/b:a==+b;case"[object Date]":case"[object Boolean]":return+a==+b;case"[object RegExp]":return a.source==b.source&&a.global==b.global&&a.multiline==b.multiline&&a.ignoreCase==b.ignoreCase}if("object"!=typeof a||"object"!=typeof b)return!1;for(var f=c.length;f--;)if(c[f]==a)return d[f]==b;var g=a.constructor,h=b.constructor;if(g!==h&&!(z.isFunction(g)&&g instanceof g&&z.isFunction(h)&&h instanceof h)&&"constructor"in a&&"constructor"in b)return!1;c.push(a),d.push(b);var i=0,j=!0;if("[object Array]"==e){if(i=a.length,j=i==b.length)for(;i--&&(j=H(a[i],b[i],c,d)););}else{for(var k in a)if(z.has(a,k)&&(i++,!(j=z.has(b,k)&&H(a[k],b[k],c,d))))break;if(j){for(k in b)if(z.has(b,k)&&!i--)break;j=!i}}return c.pop(),d.pop(),j};z.isEqual=function(a,b){return H(a,b,[],[])},z.isEmpty=function(a){if(null==a)return!0;if(z.isArray(a)||z.isString(a))return 0===a.length;for(var b in a)if(z.has(a,b))return!1;return!0},z.isElement=function(a){return!(!a||1!==a.nodeType)},z.isArray=w||function(a){return"[object Array]"==l.call(a)},z.isObject=function(a){return a===Object(a)},A(["Arguments","Function","String","Number","Date","RegExp"],function(a){z["is"+a]=function(b){return l.call(b)=="[object "+a+"]"}}),z.isArguments(arguments)||(z.isArguments=function(a){return!(!a||!z.has(a,"callee"))}),"function"!=typeof/./&&(z.isFunction=function(a){return"function"==typeof a}),z.isFinite=function(a){return isFinite(a)&&!isNaN(parseFloat(a))},z.isNaN=function(a){return z.isNumber(a)&&a!=+a},z.isBoolean=function(a){return a===!0||a===!1||"[object Boolean]"==l.call(a)},z.isNull=function(a){return null===a},z.isUndefined=function(a){return void 0===a},z.has=function(a,b){return m.call(a,b)},z.noConflict=function(){return a._=d,this},z.identity=function(a){return a},z.constant=function(a){return function(){return a}},z.property=function(a){return function(b){return b[a]}},z.matches=function(a){return function(b){if(b===a)return!0;for(var c in a)if(a[c]!==b[c])return!1;return!0}},z.times=function(a,b,c){for(var d=Array(Math.max(0,a)),e=0;a>e;e++)d[e]=b.call(c,e);return d},z.random=function(a,b){return null==b&&(b=a,a=0),a+Math.floor(Math.random()*(b-a+1))},z.now=Date.now||function(){return(new Date).getTime()};var I={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;"}};I.unescape=z.invert(I.escape);var J={escape:new RegExp("["+z.keys(I.escape).join("")+"]","g"),unescape:new RegExp("("+z.keys(I.unescape).join("|")+")","g")};z.each(["escape","unescape"],function(a){z[a]=function(b){return null==b?"":(""+b).replace(J[a],function(b){return I[a][b]})}}),z.result=function(a,b){if(null==a)return void 0;var c=a[b];return z.isFunction(c)?c.call(a):c},z.mixin=function(a){A(z.functions(a),function(b){var c=z[b]=a[b];z.prototype[b]=function(){var a=[this._wrapped];return i.apply(a,arguments),O.call(this,c.apply(z,a))}})};var K=0;z.uniqueId=function(a){var b=++K+"";return a?a+b:b},z.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var L=/(.)^/,M={"'":"'","\\":"\\","\r":"r","\n":"n","	":"t","\u2028":"u2028","\u2029":"u2029"},N=/\\|'|\r|\n|\t|\u2028|\u2029/g;z.template=function(a,b,c){var d;c=z.defaults({},c,z.templateSettings);var e=new RegExp([(c.escape||L).source,(c.interpolate||L).source,(c.evaluate||L).source].join("|")+"|$","g"),f=0,g="__p+='";a.replace(e,function(b,c,d,e,h){return g+=a.slice(f,h).replace(N,function(a){return"\\"+M[a]}),c&&(g+="'+\n((__t=("+c+"))==null?'':_.escape(__t))+\n'"),d&&(g+="'+\n((__t=("+d+"))==null?'':__t)+\n'"),e&&(g+="';\n"+e+"\n__p+='"),f=h+b.length,b}),g+="';\n",c.variable||(g="with(obj||{}){\n"+g+"}\n"),g="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+g+"return __p;\n";try{d=new Function(c.variable||"obj","_",g)}catch(h){throw h.source=g,h}if(b)return d(b,z);var i=function(a){return d.call(this,a,z)};return i.source="function("+(c.variable||"obj")+"){\n"+g+"}",i},z.chain=function(a){return z(a).chain()};var O=function(a){return this._chain?z(a).chain():a};z.mixin(z),A(["pop","push","reverse","shift","sort","splice","unshift"],function(a){var b=f[a];z.prototype[a]=function(){var c=this._wrapped;return b.apply(c,arguments),"shift"!=a&&"splice"!=a||0!==c.length||delete c[0],O.call(this,c)}}),A(["concat","join","slice"],function(a){var b=f[a];z.prototype[a]=function(){return O.call(this,b.apply(this._wrapped,arguments))}}),z.extend(z.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}}),"function"==typeof define&&define.amd&&define("underscore",[],function(){return z})}).call(this)},{}]},{},[1]);
//# sourceMappingURL=client.map